// config.mjs
import { fileURLToPath } from "url";
import { dirname, resolve } from "path";
import fs from "fs";
import dotenv from "dotenv";

// Determine current directory
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Load .env from root of project
const envPath = resolve(__dirname, "../.env");
dotenv.config({ path: envPath });

// Confirm .env loaded
console.log("‚úÖ Loaded .env from:", envPath);
console.log("üîê APP_CONFIG_KEYFILE:", process.env.APP_CONFIG_KEYFILE);
console.log("üîê APP_CONFIG_CERTFILE:", process.env.APP_CONFIG_CERTFILE);

// Resolve certificate paths
function safeResolveCert(envVarName) {
  const relPath = process.env[envVarName];
  if (!relPath) {
    throw new Error(`‚ùå Missing ${envVarName} in .env`);
  }

  const absPath = resolve(__dirname, "..", relPath);
  if (!fs.existsSync(absPath)) {
    throw new Error(`‚ùå File not found: ${absPath}`);
  }

  return absPath;
}

// Export HTTPS credentials
export const https_options = {
  key: fs.readFileSync(safeResolveCert("APP_CONFIG_KEYFILE")),
  cert: fs.readFileSync(safeResolveCert("APP_CONFIG_CERTFILE")),
};
